<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Drawing ZIP Code Boundaries</title>
  <link rel="stylesheet" href="/base.css" />
  <link rel="stylesheet" href="local.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Drawing ZIP Code Boundaries</h1>
</header>
<p><a href="/">← Back to main page</a></p>
<p>Local governments have made a wide variety of data available at the ZIP code level. A great way of visualizing this information is to use a choropleth map, in which each ZIP code is colored by the intensity of its value for a particular statistic.</p>
<p>In this article I’ll demonstrate how to produce a ZIP-level choropleth map using freely available tools and data. As an example, we’ll plot the total number of births in 2007 for each ZIP code in California. Here’s an example of the final output:</p>
<figure>
<img src="ca_births.png" alt="" /><figcaption>CA Births 2007</figcaption>
</figure>
<p>All the data and script files used in this example are available <a href="zipmap.zip">here</a>. If you would like further information, this <a href="http://library.csun.edu/mfinley/zipstats.html">page</a> has links to a large selection of ZIP-level data, including population, political and environmental statistics. Also, the website <a href="http://flowingdata.com/">FlowingData</a> has an excellent <a href="http://flowingdata.com/2009/11/12/how-to-make-a-us-county-thematic-map-using-free-tools/">article</a> on creating maps at the county-level.</p>
<p>OK, let’s get started.</p>
<h2 id="install-the-software">1. Install the software</h2>
<p>We’ll use <a href="http://www.python.org/">Python</a> and <a href="http://matplotlib.sourceforge.net/">matplotlib</a> to create our the map. Make sure you have both installed before proceeding.</p>
<h2 id="download-the-zip-code-boundary-data">2. Download the ZIP code boundary data</h2>
<p>The <a href="http://www.census.gov/">US Census site</a> has lots of great geographic information, including ZIP code boundary files in various formats. We’ll use the ASCII format since it’s easy to read in and manipulate in Python. The 5-digit ZIP code boundary files for each state are available <a href="http://www.census.gov/geo/www/cob/z52000.html#ascii"> here</a>. This example will use the California file zt06_d00_ascii.zip.</p>
<h2 id="download-birth-rates-by-zip-code">3. Download birth rates by ZIP code</h2>
<p>You may already have some data that you wish to plot, but for the purposes of this example we will use <a href="http://www.cdph.ca.gov/data/statistics/Pages/BirthandDeathProfilesbyZIPCode.aspx">birth rate data</a> from the California Department of Public Health. The data in this example was extracted from this <a href="http://www.cdph.ca.gov/data/statistics/Documents/birthzip2007.xls">Excel file</a> on their site and converted into CSV format (CA_2007_births_by_ZIP.txt is included in <a href="zipmap.zip">here</a>) for processing with Python.</p>
<h2 id="read-in-the-boundary-data">4. Read in the boundary data</h2>
<p>Each ASCII file from the Census website contains boundaries for all the ZIP codes in a state. There are actually two files for each state: a metadata file that ends in ‘a.dat’ and the actual boundary data which ends in just ‘.dat’.</p>
<p>The boundary for each ZIP code has a single main polygon and may also contain several ‘exclusions’ such as islands, lakes, etc. This Python function will read in the data for a given state.</p>
<pre class="python"><code>def read_ascii_boundary(filestem):
    &#39;&#39;&#39;
    Reads polygon data from an ASCII boundary file.
    Returns a dictionary with polygon IDs for keys. The value for each
    key is another dictionary with three keys:
    &#39;name&#39; - the name of the polygon
    &#39;polygon&#39; - list of (longitude, latitude) pairs defining the main
    polygon boundary
    &#39;exclusions&#39; - list of lists of (lon, lat) pairs for any exclusions in
    the main polygon
    &#39;&#39;&#39;
    metadata_file = filestem + &#39;a.dat&#39;
    data_file = filestem + &#39;.dat&#39;
    # Read metadata
    lines = [line.strip().strip(&#39;&quot;&#39;) for line in open(metadata_file)]
    polygon_ids = lines[::6]
    polygon_names = lines[2::6]
    polygon_data = {}
    for polygon_id, polygon_name in zip(polygon_ids, polygon_names):
        # Initialize entry with name of polygon.
        # In this case the polygon_name will be the 5-digit ZIP code.
        polygon_data[polygon_id] = {&#39;name&#39;: polygon_name}
    del polygon_data[&#39;0&#39;]
    # Read lon and lat.
    f = open(data_file)
    for line in f:
        fields = line.split()
        if len(fields) == 3:
            # Initialize new polygon
            polygon_id = fields[0]
            polygon_data[polygon_id][&#39;polygon&#39;] = []
            polygon_data[polygon_id][&#39;exclusions&#39;] = []
        elif len(fields) == 1:
            # -99999 denotes the start of a new sub-polygon
            if fields[0] == &#39;-99999&#39;:
                polygon_data[polygon_id][&#39;exclusions&#39;].append([])
        else:
            # Add lon/lat pair to main polygon or exclusion
            lon = float(fields[0])
            lat = float(fields[1])
            if polygon_data[polygon_id][&#39;exclusions&#39;]:
                polygon_data[polygon_id][&#39;exclusions&#39;][-1].append((lon, lat))
            else:
                polygon_data[polygon_id][&#39;polygon&#39;].append((lon, lat))
    return polygon_data</code></pre>
<h2 id="draw-the-zip-codes-colored-by-number-of-births">5. Draw the ZIP codes colored by number of births</h2>
<p>And finally here’s the full script that creates the final map:</p>
<pre class="python"><code>import csv
from pylab import *

# Read in ZIP code boundaries for California
d = read_ascii_boundary(&#39;../data/zip5/zt06_d00&#39;)

# Read in data for number of births by ZIP code in California
f = csv.reader(open(&#39;../data/CA_2007_births_by_ZIP.txt&#39;, &#39;rb&#39;))
births = {}
# Skip header line
f.next()
# Add data for each ZIP code
for row in f:
    zipcode, totalbirths = row
    births[zipcode] = float(totalbirths)
max_births = max(births.values())

# Create figure and two axes: one to hold the map and one to hold
# the colorbar
figure(figsize=(5, 5), dpi=30)
map_axis = axes([0.0, 0.0, 0.8, 0.9])
cb_axis = axes([0.83, 0.1, 0.03, 0.6])

# Define colormap to color the ZIP codes.
# You can try changing this to cm.Blues or any other colormap
# to get a different effect
cmap = cm.PuRd

# Create the map axis
axes(map_axis)
axis([-125, -114, 32, 42.5])
gca().set_axis_off()

# Loop over the ZIP codes in the boundary file
for polygon_id in d:
    polygon_data = array(d[polygon_id][&#39;polygon&#39;])
    zipcode = d[polygon_id][&#39;name&#39;]
    num_births = births[zipcode] if zipcode in births else 0.
    # Define the color for the ZIP code
    fc = cmap(num_births / max_births)
    # Draw the ZIP code
    patch = Polygon(array(polygon_data), facecolor=fc,
        edgecolor=(.3, .3, .3, 1), linewidth=.2)
    gca().add_patch(patch)
title(&#39;Births per ZIP Code in California (2007)&#39;)

# Draw colorbar
cb = mpl.colorbar.ColorbarBase(cb_axis, cmap=cmap,
    norm = mpl.colors.Normalize(vmin=0, vmax=max_births))
cb.set_label(&#39;Number of births&#39;)

# Change all fonts to Arial
for o in gcf().findobj(matplotlib.text.Text):
    o.set_fontname(&#39;Arial&#39;)

# Export figure to bitmap
savefig(&#39;../images/ca_births.png&#39;)</code></pre>
</body>
</html>
